var __decorate=this&&this.__decorate||function(t,e,r,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,u;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)if(u=t[a])i=(o<3?u(i):o>3?u(e,r,i):u(e,r))||i;return o>3&&i&&Object.defineProperty(e,r,i),i};var __metadata=this&&this.__metadata||function(t,e){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(t,e)};define("VrtDao",["require","exports","aurelia-framework","aurelia-fetch-client"],function(t,e,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:true});var o=function(){function t(t){this.http=t}t.prototype.getRoutes=function(){return this.http.fetch("https://vrt.routematch.com/feed/masterRoute").then(function(t){return t.json()}).then(function(t){t.data.sort(function(t,e){var r=/\d+/g;var n=t.shortName.match(r)[0];var o=e.shortName.match(r)[0];return n-o});return t}).catch(function(t){console.log(t)})};t.prototype.getStopsOnRoute=function(t){return this.http.fetch("https://vrt.routematch.com/feed/stops/"+t).then(function(t){return t.json()}).then(function(t){return t}).catch(function(t){console.log(t)})};t.prototype.getStatusForStop=function(t){return this.http.fetch("https://vrt.routematch.com/feed/departures/byStop/"+t).then(function(t){return t.json()}).then(function(t){return t}).catch(function(t){console.log(t)})};t=__decorate([r.inject(n.HttpClient),__metadata("design:paramtypes",[Object])],t);return t}();e.VrtDao=o});define("app",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:true});var r=function(){function t(){}t.prototype.configureRouter=function(t,e){this.router=e;t.title="VRT Dashboard";t.map([{route:["","bus"],name:"bus",moduleId:"bus-tracker",title:"Home"}])};return t}();e.App=r});define("text!app.html",[],function(){return'<template>\n  <ul repeat.for="nav of router.navigation">\n      <li class="${nav.isActive ? \'active\' : \'\'}"><a href.bind="nav.href">${nav.title}</a></li>\n  </ul>\n  <router-view></router-view>\n</template>'});var __decorate=this&&this.__decorate||function(t,e,r,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,u;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)if(u=t[a])i=(o<3?u(i):o>3?u(e,r,i):u(e,r))||i;return o>3&&i&&Object.defineProperty(e,r,i),i};var __metadata=this&&this.__metadata||function(t,e){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(t,e)};define("bus-tracker",["require","exports","aurelia-framework","VrtDao","aurelia-router"],function(t,e,r,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:true});var i=function(){function t(t,e){var r=this;this.currentStop=undefined;this.currentRoute=undefined;this.selectedRoute=undefined;this.selectedStop=undefined;this.notCurrentlyRequesting=true;this.interval=undefined;this.getStatusForCurrentStop=function(){if(r.currentStop&&r.notCurrentlyRequesting){r.notCurrentlyRequesting=false;r.vrtDao.getStatusForStop(r.currentStop).then(function(t){r.notCurrentlyRequesting=true;r.currentStopInfo=t})}};this.vrtDao=t;this.router=e;setInterval(function(){return r.updateTimeSinceLastDataTimestamp()},1e3)}t.prototype.selectedRouteChanged=function(t,e){var r=this;this.stops=undefined;if(this.selectedRoute){this.currentRoute=this.selectedRoute.routeId;this.vrtDao.getStopsOnRoute(this.currentRoute).then(function(t){t.data.forEach(function(t){if(t.stopId==r.currentStop)r.selectedStop=t});r.stops=t})}};t.prototype.selectedStopChanged=function(t,e){if(this.selectedStop){this.currentStopInfo=undefined;this.currentStop=this.selectedStop.stopId;if(this.interval)clearInterval(this.interval);this.getStatusForCurrentStop();this.interval=setInterval(this.getStatusForCurrentStop,1e4);this.router.navigate(this.router.generate("bus",{stopId:this.currentStop,routeId:this.currentRoute}))}};t.prototype.determineActivationStrategy=function(){return o.activationStrategy.noChange};t.prototype.activate=function(t,e,r){var n=this;this.currentRoute=t.routeId;this.currentStop=t.stopId;this.vrtDao.getRoutes().then(function(t){t.data.forEach(function(t){if(t.routeId==n.currentRoute)n.selectedRoute=t});n.routes=t})};t.prototype.updateTimeSinceLastDataTimestamp=function(){if(this.currentStopInfo)this.timeSinceLastDataTimestamp=Math.round(((new Date).getTime()-new Date(this.currentStopInfo.time).getTime())/1e3)};__decorate([r.observable,__metadata("design:type",Object)],t.prototype,"selectedRoute",void 0);__decorate([r.observable,__metadata("design:type",Object)],t.prototype,"selectedStop",void 0);t=__decorate([r.inject(n.VrtDao,o.Router),__metadata("design:paramtypes",[Object,Object])],t);return t}();e.BusTracker=i});define("text!bus-tracker.html",[],function(){return'<template>\r\n    <select if.bind="routes" value.bind="selectedRoute">\r\n        <option model.bind="undefined">Choose...</option>\r\n        <option repeat.for="route of routes.data" model.bind="route">\r\n            ${route.longName}\r\n        </option>\r\n    </select>\r\n    <select if.bind="stops" value.bind="selectedStop">\r\n        <option model.bind="undefined">Choose...</option>\r\n        <option repeat.for="stop of stops.data" model.bind="stop">\r\n            ${stop.stopDescription}(${stop.stopId})\r\n        </option>\r\n    </select>\r\n    <div if.bind="notCurrentlyRequesting">Estimates</div>\r\n    <div if.bind="!notCurrentlyRequesting">Estimates Refreshing...</div>\r\n    <div if.bind="currentStopInfo">Estimates are ${timeSinceLastDataTimestamp} seconds old</div>\r\n    <div if.bind="currentStopInfo" repeat.for="arriving of currentStopInfo.data">${arriving.routeLongName}: ${arriving.status} to ${arriving.destination}</div>\r\n</template>'});define("environment",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.default={debug:false,testing:false}});define("main",["require","exports","./environment"],function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:true});function n(t){t.use.standardConfiguration().feature("resources");t.use.developmentLogging(r.default.debug?"debug":"warn");if(r.default.testing){t.use.plugin("aurelia-testing")}return t.start().then(function(){return t.setRoot()})}e.configure=n});define("resources/index",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:true});function r(t){}e.configure=r});define("resources",["resources/index"],function(t){return t});